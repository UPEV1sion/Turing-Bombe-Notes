\documentclass[ngerman, a4paper, footsepline, headsepline]{scrreport}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{babel, lmodern, scrlayer-scrpage, amsmath, amsmath, amsfonts, graphicx, tikz, algorithm, algpseudocode}
\usepackage[bottom=4cm]{geometry}

\pagestyle{scrheadings}
\newcommand{\myifoot}{\textbf{Emanuel Schäffer}}
%\newcommand{\mycfoot}{\textbf{RWU--University of Applied Sciences}}
\automark{section}
%\ofoot{\mycfoot}
\ohead{\headmark}
\chead{}
\ifoot{\myifoot}

\newcommand{\figref}[1]{(siehe Abb.~\ref{#1})}

\newcommand{\aszboxy}[1]{
	\begin{center}
		\fcolorbox{black}{yellow}
		{\parbox{0.88\textwidth}
			{\textcolor{black}
				{#1}
			}
		}
	\end{center}
}

\begin{document}
	\subject{Kryptoanalyse der Enigma-Maschine: Eine Untersuchung des Cyclometers und der Turing-Bombe}
	\title{Kryptoanalyse der Enigma-Maschine}
	\author{Emanuel Schäffer}
	\date{\today}
	\publishers{RWU--University of Applied Sciences}
	\maketitle
	
	\begin{abstract}
		Enigma-Nachrichten können dechiffriert werden, wenn die Rotorauswahl, die Rotor-~, Ringstellungen und die Steckereinstellungen einzeln wiederhergestellt werden. Die Wiederherstellung der Nachrichtenschlüsseleinstellung ist empfindlich genug, um die korrekte Rotorreihenfolge zu unterscheiden. 
	\end{abstract}


	\chapter{Enigma}
	\section{Einführung}
	Die Enigma ist eine Rotor-Chiffriermaschine, die hauptsächlich im Zweiten Weltkrieg Einsatz kam. Die von der Wehrmacht modifizierte Enigma verfügte zunächst über drei Walzen und zusätzlich einen Reflektor. Jede dieser Walzen führte eine monoalphabetische Substitution durch. Die rechte Walze wurde bei jedem Tastendruck um eine Position weitergerückt. Hat diese Walze eine komplette Rotation vollzogen, rückte die Walze links neben ihr um eine Position weiter\footnote{Eine Analogie hierfür ist der Kilometerzähler eines mechanischen Tachometers oder das Verhalten von Sekunden-, Minuten- und Studenzeigern einer Uhr.}. Neuerungen waren das Steckerbrett \figref{fig:enigma_complete} und gegen Ende des Krieges eine zusätzliche, vierte Walze. Ich werde mich, wenn nicht ausdrücklich erwähnt, auf die Enigma M3 mit drei Walzen beschränken.
	\nopagebreak
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=.5\linewidth]{Enigma-komplett.png}
		\caption{Die Enigma Maschine}
		\label{fig:enigma_complete}
	\end{figure}
	
	\newpage
	
	 Bei der Enigma wurde jeden Tag  eine Tagesschlüssel eingestellt, welcher durch ein Code-Buch vorgegeben war. Dieser Tagesschlüssel bestand darin, welche drei der fünf Walzen der Schlüssler in welcher Reihenfolge einzusetzen hatte. Ferner musste er die Walzenstellung einstellen. Sie bestimmt die Ausgangsstellung der Walzen. Diese konnte durch ein Sichtfenster abgelesen werden.
	
	\begin{figure}[htbp]
		\centering
		\includegraphics[width=.4\linewidth]{Enigma-rotor-set.png}
		\caption{Enigma-Walzen}
		\label{fig:enigma_rotors}
	\end{figure}
	
	Zusätzlich musste der Schlüssler die Ringstellung des Tages einstellen. Die Ringstellung veränderte die Relation der sichtbaren Buchstaben mit der internen Verdrahtung und bewegte die Übertragskerbe \figref{fig:enigma-rotor-contact}, die festlegte, wann sich die Walze links von der aktuellen bewegt.
	
	\begin{figure}[htbp]
		\centering
		\begin{tikzpicture}
			\node at (0,0) {\includegraphics[width=.3\linewidth]{Enigma-rotor-flat-contacts.png}};
			\draw[red, very thick, ->] (-3,-0.5) -- (-1.5,-0.1) ;
			\node[red, anchor=west] at (-5,-0.8) {Übertragskerbe};
		\end{tikzpicture}
		\caption{Walzen Frontansicht mit Übertragskerbe}
		\label{fig:enigma-rotor-contact}
	\end{figure}
	
	\newpage
	Als letzte Einstellung musste das Steckerbrett verdrahtet werden. Das Steckerbrett vertauschte zwei Buchstaben miteinander. Von 13 möglichen Steckerverbindungen wurden meistens 10 vorgegeben. 
		
		
	Wenn der Schlüssler nun eine Taste auf der Tastatur betätigte, floss Strom durch das Steckerbrett, welches eine Substitution durchführt. Danach floss der Strom durch den Walzensatz, in den Reflektor und nochmals in entgegengesetzter Richtung durch den Walzensatz. Jeder dieser Walzen führte eine monoalphabetische Substitution durch. Nach dem der Strom den Walzensatz verlassen hatte, floss der Strom nochmals durch das Steckerbrett und erleuchtete letztendlich eine Lampe.
	\begin{figure}[htbp]
		\centering
		\caption{Verdrahtung Walze I}
		\resizebox{\textwidth}{!}{%
			\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
				\hline	
				A & B & C & D & E & F & G & H & I & J & K & L & M & N & O & P & Q & R & S & T & U & V & W & X & Y & Z\\
				\hline
				E & K & M & F & L & G & D & Q & V & Z & N & T & O & W & Y & H & X & U & S & P & A & I & B & R & C & J\\
				\hline
			\end{tabular}
		}
		\label{fig:rot1_cabeling}
	\end{figure}
	
	
	
	
	\section{Übertragung der Nachrichten}
	Nachdem alle Einstellung getroffen waren, überlegte sich der Schlüssler einen "`zufälligen"' Spruchschlüssel, mit dem der Text verschlüsselt wurde.\footnote{In Wahrheit wählten die Schlüssler oft den gleichen Schlüssel, der meist persönliche Informationen wie zum Beispiel den Name der Freundin enthielt.} Dieser Spruchschlüssel gab die Walzenstellung für die folgende Nachricht an. Der "`zufällige"' Spruchschlüssel wurde mit dem Tagesschlüssel verschlüsselt und ergab zusammen mit anderen Zusatzinformationen den "`Spruchkopf"'. Der Schlüssler gab nun den zu verschlüsselnden Text nach bestimmten Regeln ein. Eine Eigenschaft der Enigma ist, dass sie selbstinvers ist. Das bedeutet, dass mit der gleichen Einstellung, mit der ein Text verschlüsselt wurde, dieser auch wieder entschlüsselt werden kann.
	
	
	
	
	\chapter {Bombe}
	
	\section{Algorithmus Bombe}
	
	\begin{algorithm}
		\caption{Bombe Algorithmus}
		\begin{algorithmic}[1]
			\Procedure{Bombe}{$p_0 \dots p_{n-1} :$ [Char], $c_0 \dots c_{n-1} :$ [Char]}
				\ForAll{\textsl{rotors} $\in$ \textbf{permut(rotor order)}, \textsl{pos} $\in$ \textbf{[AAA $\dots$ ZZZ]}}
					\State plugs: Char $\rightarrow \{ $Char$\}$
					\State plugs$(p_0)\ \cup= \{\textbf{'A'}\}$
					\While{\textsl{plugs} changing}
						\ForAll{\textsl{i} $\in$ \textbf{[0\dots n--1]}}
							\State plugs($c_i$) $\cup=$ $\bigcup_{p \in \text{plugs}(p_i)}$ encrypt(\textsl{rotors, p, pos}+\textsl{i})
							\State plugs($p_i$) $\cup=$ $\bigcup_{p \in \text{plugs}(c_i)}$ encrypt(\textsl{rotors, p, pos}+\textsl{i})
						\EndFor
					\EndWhile
					\If{$\forall$ \textsl{S} $\in$ \textbf{cod(plugs)}: \#S < \#Char}
						\State report(\textsl{pos, plugs})
					\EndIf
				\EndFor
			\EndProcedure
		\end{algorithmic}
	\end{algorithm}
	
	\section{Cycle Finding Algorithm}
	\noindent
	\texttt{typedef struct \{} \\
	\hspace*{0.5cm} \texttt{char first;} \\
	\hspace*{0.5cm} \texttt{char second;} \\
	\texttt{\} Tuple;}
		\begin{algorithm}
			\caption{Cycle Finding Algorithm}
			\begin{algorithmic}[1]
				\Procedure{is\_cyle}{$start :$ \textbf{char}, $c:$ char, $tuples_0 \dots tuples_{n-1}:$ Tuple, $visited\_mask:$ uint32\_t}
				\EndProcedure
			\end{algorithmic}
		\end{algorithm}
	
	
	
	\chapter{Häufigkeitsanalyse}
	\section{Koinzidenzindex}
	\thispagestyle{scrheadings}
	
	Zunächst benötigen wir ein geeignetes Maß, um den Grad der Annäherung eines teilweise dechiffrierten Klartextes an authentisches Deutsch abzuschätzen. Dafür verwenden wir den Koinzidenzindex:
	
	$$
	IC = \frac{\sum_{i=A}^{Z}f_i(f_i-1)}{N(N-1)}
	$$
	
	Sei $f_i$ die Häufigkeit des Buchstabens in Abhängigkeit von $i$ und $N$ die Gesamtanzahl der Buchstaben. Wir Summieren also die Anzahl der Buchstabenpaare auf, und teilen diese durch die Anzahl der allgemein möglichen Buchstabenpaare. Der Koinzidenzindex ist also ein Maß für die Buchstabenverteilung. Für ein Text bestehend aus zufälligen Buchstaben beträgt der $IC \approx$ 0.038; wobei er für Deutsch $\approx$ 0.076 beträgt.
	\newpage
	
	Bemerkungen:
	
	Improvements:
	
	Base: 8.5s
	
	Nur letzte Buchstaben testen: 3.6s
	
	IC: 3.3s
	
	Low Level IO: 3.31s
	
	Nur erster char testen an der Position, an dem das Schlagwort stehen muss: 2.25s 
	
	
	\chapter{Quellen}
	
	%Deutsches Museum, Ertl Angewandte Kryptographie \ref{fig:enigma_complete}
	
	%https://upload.wikimedia.org/wikipedia/commons/9/9f/Enigma_rotor_set.png Zugriff %11.09.24. 10:57 \ref{fig:enigma_rotors}
	
	%https://de.wikipedia.org/wiki/Enigma-Walzen#/media/Datei:Enigma-rotor-flat-contacts.jpg Zugriff 11.09.24. 11:19 \ref{fig:enigma-rotor-contact}
	
	
	
\end{document}